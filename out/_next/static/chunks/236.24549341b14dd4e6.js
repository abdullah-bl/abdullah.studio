(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[236],{666:e=>{!function(){var t={229:function(e){var t,r,a,n=e.exports={};function i(){throw Error("setTimeout has not been defined")}function o(){throw Error("clearTimeout has not been defined")}try{t="function"==typeof setTimeout?setTimeout:i}catch(e){t=i}try{r="function"==typeof clearTimeout?clearTimeout:o}catch(e){r=o}function s(e){if(t===setTimeout)return setTimeout(e,0);if((t===i||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(r){try{return t.call(null,e,0)}catch(r){return t.call(this,e,0)}}}var l=[],u=!1,d=-1;function f(){u&&a&&(u=!1,a.length?l=a.concat(l):d=-1,l.length&&c())}function c(){if(!u){var e=s(f);u=!0;for(var t=l.length;t;){for(a=l,l=[];++d<t;)a&&a[d].run();d=-1,t=l.length}a=null,u=!1,function(e){if(r===clearTimeout)return clearTimeout(e);if((r===o||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(e);try{r(e)}catch(t){try{return r.call(null,e)}catch(t){return r.call(this,e)}}}(e)}}function h(e,t){this.fun=e,this.array=t}function g(){}n.nextTick=function(e){var t=Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];l.push(new h(e,t)),1!==l.length||u||s(c)},h.prototype.run=function(){this.fun.apply(null,this.array)},n.title="browser",n.browser=!0,n.env={},n.argv=[],n.version="",n.versions={},n.on=g,n.addListener=g,n.once=g,n.off=g,n.removeListener=g,n.removeAllListeners=g,n.emit=g,n.prependListener=g,n.prependOnceListener=g,n.listeners=function(e){return[]},n.binding=function(e){throw Error("process.binding is not supported")},n.cwd=function(){return"/"},n.chdir=function(e){throw Error("process.chdir is not supported")},n.umask=function(){return 0}}},r={};function a(e){var n=r[e];if(void 0!==n)return n.exports;var i=r[e]={exports:{}},o=!0;try{t[e](i,i.exports,a),o=!1}finally{o&&delete r[e]}return i.exports}a.ab="//",e.exports=a(229)}()},2747:(e,t,r)=>{"use strict";r.d(t,{Hy:()=>v,fr:()=>m});var a=r(1430),n=r(3951),i=r(9788),o=r(2373);function s(e){if(e.includes("."))return e;if(e.includes(":")){let[t,r]=e.split(":").map(Number);return 0===r?`${t} o'clock`:r<10?`${t} oh ${r}`:`${t} ${r}`}let t=parseInt(e.slice(0,4),10);if(t<1100||t%1e3<10)return e;let r=e.slice(0,2),a=parseInt(e.slice(2,4),10),n=e.endsWith("s")?"s":"";if(t%1e3>=100&&t%1e3<=999){if(0===a)return`${r} hundred${n}`;if(a<10)return`${r} oh ${a}${n}`}return`${r} ${a}${n}`}function l(e){let t="$"===e[0]?"dollar":"pound";if(isNaN(Number(e.slice(1))))return`${e.slice(1)} ${t}s`;if(!e.includes(".")){let r="1"===e.slice(1)?"":"s";return`${e.slice(1)} ${t}${r}`}let[r,a]=e.slice(1).split("."),n=parseInt(a.padEnd(2,"0"),10);return`${r} ${t}${"1"===r?"":"s"} and ${n} ${"$"===e[0]?1===n?"cent":"cents":1===n?"penny":"pence"}`}function u(e){let[t,r]=e.split(".");return`${t} point ${r.split("").join(" ")}`}let d=RegExp(`(\\s*[${';:,.!?\xa1\xbf—…"\xab\xbb“”(){}[]'.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}]+\\s*)+`,"g");async function f(e,t="a",r=!0){r&&(e=e.replace(/[‘’]/g,"'").replace(/«/g,"“").replace(/»/g,"”").replace(/[“”]/g,'"').replace(/\(/g,"\xab").replace(/\)/g,"\xbb").replace(/、/g,", ").replace(/。/g,". ").replace(/！/g,"! ").replace(/，/g,", ").replace(/：/g,": ").replace(/；/g,"; ").replace(/？/g,"? ").replace(/[^\S \n]/g," ").replace(/  +/," ").replace(/(?<=\n) +(?=\n)/g,"").replace(/\bD[Rr]\.(?= [A-Z])/g,"Doctor").replace(/\b(?:Mr\.|MR\.(?= [A-Z]))/g,"Mister").replace(/\b(?:Ms\.|MS\.(?= [A-Z]))/g,"Miss").replace(/\b(?:Mrs\.|MRS\.(?= [A-Z]))/g,"Mrs").replace(/\betc\.(?! [A-Z])/gi,"etc").replace(/\b(y)eah?\b/gi,"$1e'a").replace(/\d*\.\d+|\b\d{4}s?\b|(?<!:)\b(?:[1-9]|1[0-2]):[0-5]\d\b(?!:)/g,s).replace(/(?<=\d),(?=\d)/g,"").replace(/[$£]\d+(?:\.\d+)?(?: hundred| thousand| (?:[bm]|tr)illion)*\b|[$£]\d+\.\d\d?\b/gi,l).replace(/\d*\.\d+/g,u).replace(/(?<=\d)-(?=\d)/g," to ").replace(/(?<=\d)S/g," S").replace(/(?<=[BCDFGHJ-NP-TV-Z])'?s\b/g,"'S").replace(/(?<=X')S\b/g,"s").replace(/(?:[A-Za-z]\.){2,} [a-z]/g,e=>e.replace(/\./g,"-")).replace(/(?<=[A-Z])\.(?=[A-Z])/gi,"-").trim());let a=function(e,t){let r=[],a=0;for(let n of e.matchAll(t)){let t=n[0];a<n.index&&r.push({match:!1,text:e.slice(a,n.index)}),t.length>0&&r.push({match:!0,text:t}),a=n.index+t.length}return a<e.length&&r.push({match:!1,text:e.slice(a)}),r}(e,d),i="a"===t?"en-us":"en",o=(await Promise.all(a.map(async({match:e,text:t})=>e?t:(await (0,n.q)(t,i)).join(" ")))).join("").replace(/kəkˈoːɹoʊ/g,"kˈoʊkəɹoʊ").replace(/kəkˈɔːɹəʊ/g,"kˈəʊkəɹəʊ").replace(/ʲ/g,"j").replace(/r/g,"ɹ").replace(/x/g,"k").replace(/ɬ/g,"l").replace(/(?<=[a-zɹː])(?=hˈʌndɹɪd)/g," ").replace(/ z(?=[;:,.!?¡¿—…"«»“” ]|$)/g,"z");return"a"===t&&(o=o.replace(/(?<=nˈaɪn)ti(?!ː)/g,"di")),o.trim()}function c(e,t=!0){return".!?…。？！".includes(e)||t&&"\n"===e}let h=new Set(["mr","mrs","ms","dr","prof","sr","jr","sgt","col","gen","rep","sen","gov","lt","maj","capt","st","mt","etc","co","inc","ltd","dept","vs","p","pg","jan","feb","mar","apr","jun","jul","aug","sep","sept","oct","nov","dec","sun","mon","tu","tue","tues","wed","th","thu","thur","thurs","fri","sat"]),g=new Map([[")","("],["]","["],["}","{"],["》","《"],["〉","〈"],["›","‹"],["\xbb","\xab"],["〉","〈"],["」","「"],["』","『"],["〕","〔"],["】","【"]]),p=new Set(g.values());class m{constructor(){this._buffer="",this._sentences=[],this._resolver=null,this._closed=!1}push(...e){for(let t of e)this._buffer+=t,this._process()}close(){if(this._closed)throw Error("Stream is already closed.");this._closed=!0,this.flush()}flush(){let e=this._buffer.trim();e.length>0&&this._sentences.push(e),this._buffer="",this._resolve()}_resolve(){this._resolver&&(this._resolver(),this._resolver=null)}_process(){let e=0,t=this._buffer,r=t.length,a=0,n=[],i=e=>{var a;let n=e;for(;n+1<r&&c(t[n+1],!1);)++n;for(;n+1<r&&(a=t[n+1],"\"')]}」』".includes(a));)++n;let i=n+1;for(;i<r&&/\s/.test(t[i]);)++i;return{end:n,nextNonSpace:i}};for(;a<r;){let s=t[a];if(function(e,t,r,a){if('"'===e||"'"===e){if("'"===e&&r>0&&r<a.length-1&&/[A-Za-z]/.test(a[r-1])&&/[A-Za-z]/.test(a[r+1]))return;return t.length&&t.at(-1)===e?t.pop():t.push(e)}if(p.has(e))return t.push(e);let n=g.get(e);n&&t.length&&t.at(-1)===n&&t.pop()}(s,n,a,t),0===n.length&&c(s)){var o;let n=t.slice(e,a);if(/(^|\n)\d+$/.test(n)){++a;continue}let{end:l,nextNonSpace:u}=i(a);if(a===u-1&&"\n"!==s){++a;continue}if(u===r)break;let d=a-1;for(;d>=0&&/\S/.test(t[d]);)d--;let f=function(e,t){let r=t;for(;r<e.length&&!/\s/.test(e[r]);)++r;return e.substring(t,r)}(t,d=Math.max(e,d+1));if(!f){++a;continue}if((/https?[,:]\/\//.test(f)||f.includes("@"))&&!c(f.at(-1))){a=d+f.length;continue}if(o=(o=f).replace(/['’]s$/i,"").replace(/\.+$/,""),h.has(o.toLowerCase())||/^([A-Za-z]\.)+$/.test(f)&&u<r&&/[A-Z]/.test(t[u])||"."===s&&u<r&&/[a-z]/.test(t[u])){++a;continue}let g=t.substring(e,l+1).trim();if("..."===g||"…"===g){++a;continue}g&&this._sentences.push(g),a=e=l+1}else++a}this._buffer=t.substring(e),this._sentences.length>0&&this._resolve()}async *[Symbol.asyncIterator](){if(this._resolver)throw Error("Another iterator is already active.");for(;;)if(this._sentences.length>0)yield this._sentences.shift();else{if(this._closed)break;await new Promise(e=>{this._resolver=e})}}[Symbol.iterator](){this.flush();let e=this._sentences[Symbol.iterator]();return this._sentences=[],e}get sentences(){return this._sentences}}let y=Object.freeze({af_heart:{name:"Heart",language:"en-us",gender:"Female",traits:"❤️",targetQuality:"A",overallGrade:"A"},af_alloy:{name:"Alloy",language:"en-us",gender:"Female",targetQuality:"B",overallGrade:"C"},af_aoede:{name:"Aoede",language:"en-us",gender:"Female",targetQuality:"B",overallGrade:"C+"},af_bella:{name:"Bella",language:"en-us",gender:"Female",traits:"\uD83D\uDD25",targetQuality:"A",overallGrade:"A-"},af_jessica:{name:"Jessica",language:"en-us",gender:"Female",targetQuality:"C",overallGrade:"D"},af_kore:{name:"Kore",language:"en-us",gender:"Female",targetQuality:"B",overallGrade:"C+"},af_nicole:{name:"Nicole",language:"en-us",gender:"Female",traits:"\uD83C\uDFA7",targetQuality:"B",overallGrade:"B-"},af_nova:{name:"Nova",language:"en-us",gender:"Female",targetQuality:"B",overallGrade:"C"},af_river:{name:"River",language:"en-us",gender:"Female",targetQuality:"C",overallGrade:"D"},af_sarah:{name:"Sarah",language:"en-us",gender:"Female",targetQuality:"B",overallGrade:"C+"},af_sky:{name:"Sky",language:"en-us",gender:"Female",targetQuality:"B",overallGrade:"C-"},am_adam:{name:"Adam",language:"en-us",gender:"Male",targetQuality:"D",overallGrade:"F+"},am_echo:{name:"Echo",language:"en-us",gender:"Male",targetQuality:"C",overallGrade:"D"},am_eric:{name:"Eric",language:"en-us",gender:"Male",targetQuality:"C",overallGrade:"D"},am_fenrir:{name:"Fenrir",language:"en-us",gender:"Male",targetQuality:"B",overallGrade:"C+"},am_liam:{name:"Liam",language:"en-us",gender:"Male",targetQuality:"C",overallGrade:"D"},am_michael:{name:"Michael",language:"en-us",gender:"Male",targetQuality:"B",overallGrade:"C+"},am_onyx:{name:"Onyx",language:"en-us",gender:"Male",targetQuality:"C",overallGrade:"D"},am_puck:{name:"Puck",language:"en-us",gender:"Male",targetQuality:"B",overallGrade:"C+"},am_santa:{name:"Santa",language:"en-us",gender:"Male",targetQuality:"C",overallGrade:"D-"},bf_emma:{name:"Emma",language:"en-gb",gender:"Female",traits:"\uD83D\uDEBA",targetQuality:"B",overallGrade:"B-"},bf_isabella:{name:"Isabella",language:"en-gb",gender:"Female",targetQuality:"B",overallGrade:"C"},bm_george:{name:"George",language:"en-gb",gender:"Male",targetQuality:"B",overallGrade:"C"},bm_lewis:{name:"Lewis",language:"en-gb",gender:"Male",targetQuality:"C",overallGrade:"D+"},bf_alice:{name:"Alice",language:"en-gb",gender:"Female",traits:"\uD83D\uDEBA",targetQuality:"C",overallGrade:"D"},bf_lily:{name:"Lily",language:"en-gb",gender:"Female",traits:"\uD83D\uDEBA",targetQuality:"C",overallGrade:"D"},bm_daniel:{name:"Daniel",language:"en-gb",gender:"Male",traits:"\uD83D\uDEB9",targetQuality:"C",overallGrade:"D"},bm_fable:{name:"Fable",language:"en-gb",gender:"Male",traits:"\uD83D\uDEB9",targetQuality:"B",overallGrade:"C"}}),b=new Map;async function w(e){if(b.has(e))return b.get(e);let t=new Float32Array(await async function(e){let t;if(o&&Object.hasOwn(o,"readFile")){let t="undefined"!=typeof __dirname?__dirname:void 0,r=i.resolve(t,`../voices/${e}.bin`),{buffer:a}=await o.readFile(r);return a}let r=`https://huggingface.co/onnx-community/Kokoro-82M-v1.0-ONNX/resolve/main/voices/${e}.bin`;try{t=await caches.open("kokoro-voices");let e=await t.match(r);if(e)return await e.arrayBuffer()}catch(e){console.warn("Unable to open cache",e)}let a=await fetch(r),n=await a.arrayBuffer();if(t)try{await t.put(r,new Response(n,{headers:a.headers}))}catch(e){console.warn("Unable to cache file",e)}return n}(e));return b.set(e,t),t}class v{constructor(e,t){this.model=e,this.tokenizer=t}static async from_pretrained(e,{dtype:t="fp32",device:r=null,progress_callback:n=null}={}){let i=a.Dlv.from_pretrained(e,{progress_callback:n,dtype:t,device:r}),o=a.v6I.from_pretrained(e,{progress_callback:n});return new v(...await Promise.all([i,o]))}get voices(){return y}list_voices(){console.table(y)}_validate_voice(e){if(!y.hasOwnProperty(e))throw console.error(`Voice "${e}" not found. Available voices:`),console.table(y),Error(`Voice "${e}" not found. Should be one of: ${Object.keys(y).join(", ")}.`);return e.at(0)}async generate(e,{voice:t="af_heart",speed:r=1}={}){let a=this._validate_voice(t),n=await f(e,a),{input_ids:i}=this.tokenizer(n,{truncation:!0});return this.generate_from_ids(i,{voice:t,speed:r})}async generate_from_ids(e,{voice:t="af_heart",speed:r=1}={}){let n=256*Math.min(Math.max(e.dims.at(-1)-2,0),509),i=(await w(t)).slice(n,n+256),o={input_ids:e,style:new a.qYS("float32",i,[1,256]),speed:new a.qYS("float32",[r],[1])},{waveform:s}=await this.model(o);return new a.REm(s.data,24e3)}async *stream(e,{voice:t="af_heart",speed:r=1,split_pattern:a=null}={}){let n,i=this._validate_voice(t);if(e instanceof m)n=e;else{if("string"!=typeof e)throw Error("Invalid input type. Expected string or TextSplitterStream.");{n=new m;let t=a?e.split(a).map(e=>e.trim()).filter(e=>e.length>0):[e];n.push(...t)}}for await(let e of n){let a=await f(e,i),{input_ids:n}=this.tokenizer(a,{truncation:!0}),o=await this.generate_from_ids(n,{voice:t,speed:r});yield{text:e,phonemes:a,audio:o}}}}},6016:(e,t,r)=>{"use strict";e.exports=r.p+"static/media/ort-wasm-simd-threaded.jsep.03bc89f8.wasm"},7384:(e,t,r)=>{"use strict";e.exports=r.p+"static/media/ort.bundle.min.ad35b202.mjs"},9465:(e,t,r)=>{"use strict";r.r(t),r.d(t,{InferenceSession:()=>R,TRACE:()=>C,TRACE_FUNC_BEGIN:()=>D,TRACE_FUNC_END:()=>G,Tensor:()=>B,env:()=>d,registerBackend:()=>i});let a=new Map,n=[],i=(e,t,r)=>{if(t&&"function"==typeof t.init&&"function"==typeof t.createInferenceSessionHandler){let i=a.get(e);if(void 0===i)a.set(e,{backend:t,priority:r});else if(i.priority>r)return;else if(i.priority===r&&i.backend!==t)throw Error(`cannot register backend "${e}" using priority ${r}`);if(r>=0){let t=n.indexOf(e);-1!==t&&n.splice(t,1);for(let t=0;t<n.length;t++)if(a.get(n[t]).priority<=r)return void n.splice(t,0,e);n.push(e)}return}throw TypeError("not a valid backend")},o=async e=>{let t=a.get(e);if(!t)return"backend not found.";if(t.initialized)return t.backend;{if(t.aborted)return t.error;let r=!!t.initPromise;try{return r||(t.initPromise=t.backend.init(e)),await t.initPromise,t.initialized=!0,t.backend}catch(e){return r||(t.error=`${e}`,t.aborted=!0),t.error}finally{delete t.initPromise}}},s=async e=>{let t,r=e.executionProviders||[],a=r.map(e=>"string"==typeof e?e:e.name),i=0===a.length?n:a,s=[],l=new Set;for(let e of i){let r=await o(e);"string"==typeof r?s.push({name:e,err:r}):(t||(t=r),t===r&&l.add(e))}if(!t)throw Error(`no available backend found. ERR: ${s.map(e=>`[${e.name}] ${e.err}`).join(", ")}`);for(let{name:e,err:t}of s)a.includes(e)&&console.warn(`removing requested execution provider "${e}" from session options because it is not available: ${t}`);let u=r.filter(e=>l.has("string"==typeof e?e:e.name));return[t,new Proxy(e,{get:(e,t)=>"executionProviders"===t?u:Reflect.get(e,t)})]},l="warning",u={wasm:{},webgl:{},webgpu:{},versions:{common:"1.21.0-dev.20250206-d981b153d3"},set logLevel(value){if(void 0===value)return;if("string"!=typeof value||-1===["verbose","info","warning","error","fatal"].indexOf(value))throw Error(`Unsupported logging level: ${value}`);l=value},get logLevel(){return l}};Object.defineProperty(u,"logLevel",{enumerable:!0});let d=u,f=(e,t)=>{let r="undefined"!=typeof document?document.createElement("canvas"):new OffscreenCanvas(1,1);r.width=e.dims[3],r.height=e.dims[2];let a=r.getContext("2d");if(null!=a){let n,i,o,s;t?.tensorLayout!==void 0&&"NHWC"===t.tensorLayout?(n=e.dims[2],i=e.dims[3]):(n=e.dims[3],i=e.dims[2]);let l=t?.format!==void 0?t.format:"RGB",u=t?.norm;void 0===u||void 0===u.mean?o=[255,255,255,255]:"number"==typeof u.mean?o=[u.mean,u.mean,u.mean,u.mean]:(o=[u.mean[0],u.mean[1],u.mean[2],0],void 0!==u.mean[3]&&(o[3]=u.mean[3])),void 0===u||void 0===u.bias?s=[0,0,0,0]:"number"==typeof u.bias?s=[u.bias,u.bias,u.bias,u.bias]:(s=[u.bias[0],u.bias[1],u.bias[2],0],void 0!==u.bias[3]&&(s[3]=u.bias[3]));let d=i*n,f=0,c=d,h=2*d,g=-1;"RGBA"===l?(f=0,c=d,h=2*d,g=3*d):"RGB"===l?(f=0,c=d,h=2*d):"RBG"===l&&(f=0,h=d,c=2*d);for(let t=0;t<i;t++)for(let r=0;r<n;r++){let n=(e.data[f++]-s[0])*o[0],i=(e.data[c++]-s[1])*o[1];a.fillStyle="rgba("+n+","+i+","+(e.data[h++]-s[2])*o[2]+","+(-1===g?255:(e.data[g++]-s[3])*o[3])+")",a.fillRect(r,t,1,1)}if("toDataURL"in r)return r.toDataURL();throw Error("toDataURL is not supported")}throw Error("Can not access image data")},c=(e,t)=>{let r,a="undefined"!=typeof document?document.createElement("canvas").getContext("2d"):new OffscreenCanvas(1,1).getContext("2d");if(null!=a){let n,i,o,s,l;t?.tensorLayout!==void 0&&"NHWC"===t.tensorLayout?(n=e.dims[2],i=e.dims[1],o=e.dims[3]):(n=e.dims[3],i=e.dims[2],o=e.dims[1]);let u=void 0!==t&&void 0!==t.format?t.format:"RGB",d=t?.norm;void 0===d||void 0===d.mean?s=[255,255,255,255]:"number"==typeof d.mean?s=[d.mean,d.mean,d.mean,d.mean]:(s=[d.mean[0],d.mean[1],d.mean[2],255],void 0!==d.mean[3]&&(s[3]=d.mean[3])),void 0===d||void 0===d.bias?l=[0,0,0,0]:"number"==typeof d.bias?l=[d.bias,d.bias,d.bias,d.bias]:(l=[d.bias[0],d.bias[1],d.bias[2],0],void 0!==d.bias[3]&&(l[3]=d.bias[3]));let f=i*n;if(void 0!==t&&(void 0!==t.format&&4===o&&"RGBA"!==t.format||3===o&&"RGB"!==t.format&&"BGR"!==t.format))throw Error("Tensor format doesn't match input tensor dims");let c=0,h=1,g=2,p=3,m=0,y=f,b=2*f,w=-1;"RGBA"===u?(m=0,y=f,b=2*f,w=3*f):"RGB"===u?(m=0,y=f,b=2*f):"RBG"===u&&(m=0,b=f,y=2*f),r=a.createImageData(n,i);for(let t=0;t<i*n;c+=4,h+=4,g+=4,p+=4,t++)r.data[c]=(e.data[m++]-l[0])*s[0],r.data[h]=(e.data[y++]-l[1])*s[1],r.data[g]=(e.data[b++]-l[2])*s[2],r.data[p]=-1===w?255:(e.data[w++]-l[3])*s[3]}else throw Error("Can not access image data");return r},h=(e,t)=>{let r,a;if(void 0===e)throw Error("Image buffer must be defined");if(void 0===t.height||void 0===t.width)throw Error("Image height and width must be defined");if("NHWC"===t.tensorLayout)throw Error("NHWC Tensor layout is not supported yet");let{height:n,width:i}=t,o=t.norm??{mean:255,bias:0};r="number"==typeof o.mean?[o.mean,o.mean,o.mean,o.mean]:[o.mean[0],o.mean[1],o.mean[2],o.mean[3]??255],a="number"==typeof o.bias?[o.bias,o.bias,o.bias,o.bias]:[o.bias[0],o.bias[1],o.bias[2],o.bias[3]??0];let s=void 0!==t.format?t.format:"RGBA",l=void 0!==t.tensorFormat&&void 0!==t.tensorFormat?t.tensorFormat:"RGB",u=n*i,d=new Float32Array("RGBA"===l?4*u:3*u),f=4,c=0,h=1,g=2,p=3,m=0,y=u,b=2*u,w=-1;"RGB"===s&&(f=3,c=0,h=1,g=2,p=-1),"RGBA"===l?w=3*u:"RBG"===l?(m=0,b=u,y=2*u):"BGR"===l&&(b=0,y=u,m=2*u);for(let t=0;t<u;t++,c+=f,g+=f,h+=f,p+=f)d[m++]=(e[c]+a[0])/r[0],d[y++]=(e[h]+a[1])/r[1],d[b++]=(e[g]+a[2])/r[2],-1!==w&&-1!==p&&(d[w++]=(e[p]+a[3])/r[3]);return"RGBA"===l?new $("float32",d,[1,4,n,i]):new $("float32",d,[1,3,n,i])},g=async(e,t)=>{let r,a="undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement,n="undefined"!=typeof ImageData&&e instanceof ImageData,i="undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap,o="string"==typeof e,s=t??{},l=()=>{if("undefined"!=typeof document)return document.createElement("canvas");if("undefined"!=typeof OffscreenCanvas)return new OffscreenCanvas(1,1);throw Error("Canvas is not supported")},u=e=>"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||e instanceof OffscreenCanvas?e.getContext("2d"):null;if(a){let a=l();a.width=e.width,a.height=e.height;let n=u(a);if(null!=n){let a=e.height,i=e.width;if(void 0!==t&&void 0!==t.resizedHeight&&void 0!==t.resizedWidth&&(a=t.resizedHeight,i=t.resizedWidth),void 0!==t){if(s=t,void 0!==t.tensorFormat)throw Error("Image input config format must be RGBA for HTMLImageElement");s.tensorFormat="RGBA",s.height=a,s.width=i}else s.tensorFormat="RGBA",s.height=a,s.width=i;n.drawImage(e,0,0),r=n.getImageData(0,0,i,a).data}else throw Error("Can not access image data")}else if(n){let a,n;if(void 0!==t&&void 0!==t.resizedWidth&&void 0!==t.resizedHeight?(a=t.resizedHeight,n=t.resizedWidth):(a=e.height,n=e.width),void 0!==t&&(s=t),s.format="RGBA",s.height=a,s.width=n,void 0!==t){let t=l();t.width=n,t.height=a;let i=u(t);if(null!=i)i.putImageData(e,0,0),r=i.getImageData(0,0,n,a).data;else throw Error("Can not access image data")}else r=e.data}else if(i){if(void 0===t)throw Error("Please provide image config with format for Imagebitmap");let a=l();a.width=e.width,a.height=e.height;let n=u(a);if(null!=n){let t=e.height,a=e.width;return n.drawImage(e,0,0,a,t),r=n.getImageData(0,0,a,t).data,s.height=t,s.width=a,h(r,s)}throw Error("Can not access image data")}else if(o)return new Promise((t,r)=>{let a=l(),n=u(a);if(!e||!n)return r();let i=new Image;i.crossOrigin="Anonymous",i.src=e,i.onload=()=>{a.width=i.width,a.height=i.height,n.drawImage(i,0,0,a.width,a.height);let e=n.getImageData(0,0,a.width,a.height);s.height=a.height,s.width=a.width,t(h(e.data,s))}});else throw Error("Input data provided is not supported - aborted tensor creation");if(void 0!==r)return h(r,s);throw Error("Input data provided is not supported - aborted tensor creation")},p=(e,t)=>{let{width:r,height:a,download:n,dispose:i}=t;return new $({location:"texture",type:"float32",texture:e,dims:[1,a,r,4],download:n,dispose:i})},m=(e,t)=>{let{dataType:r,dims:a,download:n,dispose:i}=t;return new $({location:"gpu-buffer",type:r??"float32",gpuBuffer:e,dims:a,download:n,dispose:i})},y=(e,t)=>{let{dataType:r,dims:a,download:n,dispose:i}=t;return new $({location:"ml-tensor",type:r??"float32",mlTensor:e,dims:a,download:n,dispose:i})},b=(e,t,r)=>new $({location:"cpu-pinned",type:e,data:t,dims:r??[t.length]}),w=new Map([["float32",Float32Array],["uint8",Uint8Array],["int8",Int8Array],["uint16",Uint16Array],["int16",Int16Array],["int32",Int32Array],["bool",Uint8Array],["float64",Float64Array],["uint32",Uint32Array],["int4",Uint8Array],["uint4",Uint8Array]]),v=new Map([[Float32Array,"float32"],[Uint8Array,"uint8"],[Int8Array,"int8"],[Uint16Array,"uint16"],[Int16Array,"int16"],[Int32Array,"int32"],[Float64Array,"float64"],[Uint32Array,"uint32"]]),A=!1,E=()=>{if(!A){A=!0;let e="undefined"!=typeof BigInt64Array&&BigInt64Array.from,t="undefined"!=typeof BigUint64Array&&BigUint64Array.from,r="undefined"!=typeof Float16Array&&Float16Array.from;e&&(w.set("int64",BigInt64Array),v.set(BigInt64Array,"int64")),t&&(w.set("uint64",BigUint64Array),v.set(BigUint64Array,"uint64")),r?(w.set("float16",Float16Array),v.set(Float16Array,"float16")):w.set("float16",Uint16Array)}},_=e=>{let t=1;for(let r=0;r<e.length;r++){let a=e[r];if("number"!=typeof a||!Number.isSafeInteger(a))throw TypeError(`dims[${r}] must be an integer, got: ${a}`);if(a<0)throw RangeError(`dims[${r}] must be a non-negative integer, got: ${a}`);t*=a}return t},T=(e,t)=>{switch(e.location){case"cpu":return new $(e.type,e.data,t);case"cpu-pinned":return new $({location:"cpu-pinned",data:e.data,type:e.type,dims:t});case"texture":return new $({location:"texture",texture:e.texture,type:e.type,dims:t});case"gpu-buffer":return new $({location:"gpu-buffer",gpuBuffer:e.gpuBuffer,type:e.type,dims:t});case"ml-tensor":return new $({location:"ml-tensor",mlTensor:e.mlTensor,type:e.type,dims:t});default:throw Error(`tensorReshape: tensor location ${e.location} is not supported`)}};class ${constructor(e,t,r){let a,n;if(E(),"object"==typeof e&&"location"in e)switch(this.dataLocation=e.location,a=e.type,n=e.dims,e.location){case"cpu-pinned":{let t=w.get(a);if(!t)throw TypeError(`unsupported type "${a}" to create tensor from pinned buffer`);if(!(e.data instanceof t))throw TypeError(`buffer should be of type ${t.name}`);this.cpuData=e.data;break}case"texture":if("float32"!==a)throw TypeError(`unsupported type "${a}" to create tensor from texture`);this.gpuTextureData=e.texture,this.downloader=e.download,this.disposer=e.dispose;break;case"gpu-buffer":if("float32"!==a&&"float16"!==a&&"int32"!==a&&"int64"!==a&&"uint32"!==a&&"uint8"!==a&&"bool"!==a&&"uint4"!==a&&"int4"!==a)throw TypeError(`unsupported type "${a}" to create tensor from gpu buffer`);this.gpuBufferData=e.gpuBuffer,this.downloader=e.download,this.disposer=e.dispose;break;case"ml-tensor":if("float32"!==a&&"float16"!==a&&"int32"!==a&&"int64"!==a&&"uint32"!==a&&"uint64"!==a&&"int8"!==a&&"uint8"!==a&&"bool"!==a&&"uint4"!==a&&"int4"!==a)throw TypeError(`unsupported type "${a}" to create tensor from MLTensor`);this.mlTensorData=e.mlTensor,this.downloader=e.download,this.disposer=e.dispose;break;default:throw Error(`Tensor constructor: unsupported location '${this.dataLocation}'`)}else{let i,o;if("string"==typeof e)if(a=e,o=r,"string"===e){if(!Array.isArray(t))throw TypeError("A string tensor's data must be a string array.");i=t}else{let r=w.get(e);if(void 0===r)throw TypeError(`Unsupported tensor type: ${e}.`);if(Array.isArray(t))if("float16"===e&&r===Uint16Array||"uint4"===e||"int4"===e)throw TypeError(`Creating a ${e} tensor from number array is not supported. Please use ${r.name} as data.`);else i="uint64"===e||"int64"===e?r.from(t,BigInt):r.from(t);else if(t instanceof r)i=t;else if(t instanceof Uint8ClampedArray)if("uint8"===e)i=Uint8Array.from(t);else throw TypeError("A Uint8ClampedArray tensor's data must be type of uint8");else throw TypeError(`A ${a} tensor's data must be type of ${r}`)}else if(o=t,Array.isArray(e)){if(0===e.length)throw TypeError("Tensor type cannot be inferred from an empty array.");let t=typeof e[0];if("string"===t)a="string",i=e;else if("boolean"===t)a="bool",i=Uint8Array.from(e);else throw TypeError(`Invalid element type of data array: ${t}.`)}else if(e instanceof Uint8ClampedArray)a="uint8",i=Uint8Array.from(e);else{let t=v.get(e.constructor);if(void 0===t)throw TypeError(`Unsupported type for tensor data: ${e.constructor}.`);a=t,i=e}if(void 0===o)o=[i.length];else if(!Array.isArray(o))throw TypeError("A tensor's dims must be a number array");n=o,this.cpuData=i,this.dataLocation="cpu"}let i=_(n);if(this.cpuData&&i!==this.cpuData.length)if(("uint4"===a||"int4"===a)&&Math.ceil(i/2)===this.cpuData.length);else throw Error(`Tensor's size(${i}) does not match data length(${this.cpuData.length}).`);this.type=a,this.dims=n,this.size=i}static async fromImage(e,t){return g(e,t)}static fromTexture(e,t){return p(e,t)}static fromGpuBuffer(e,t){return m(e,t)}static fromMLTensor(e,t){return y(e,t)}static fromPinnedBuffer(e,t,r){return b(e,t,r)}toDataURL(e){return f(this,e)}toImageData(e){return c(this,e)}get data(){if(this.ensureValid(),!this.cpuData)throw Error("The data is not on CPU. Use `getData()` to download GPU data to CPU, or use `texture` or `gpuBuffer` property to access the GPU data directly.");return this.cpuData}get location(){return this.dataLocation}get texture(){if(this.ensureValid(),!this.gpuTextureData)throw Error("The data is not stored as a WebGL texture.");return this.gpuTextureData}get gpuBuffer(){if(this.ensureValid(),!this.gpuBufferData)throw Error("The data is not stored as a WebGPU buffer.");return this.gpuBufferData}get mlTensor(){if(this.ensureValid(),!this.mlTensorData)throw Error("The data is not stored as a WebNN MLTensor.");return this.mlTensorData}async getData(e){switch(this.ensureValid(),this.dataLocation){case"cpu":case"cpu-pinned":return this.data;case"texture":case"gpu-buffer":case"ml-tensor":if(!this.downloader)throw Error("The current tensor is not created with a specified data downloader.");if(this.isDownloading)throw Error("The current tensor is being downloaded.");try{this.isDownloading=!0;let t=await this.downloader();return this.downloader=void 0,this.dataLocation="cpu",this.cpuData=t,e&&this.disposer&&(this.disposer(),this.disposer=void 0),t}finally{this.isDownloading=!1}default:throw Error(`cannot get data from location: ${this.dataLocation}`)}}dispose(){if(this.isDownloading)throw Error("The current tensor is being downloaded.");this.disposer&&(this.disposer(),this.disposer=void 0),this.cpuData=void 0,this.gpuTextureData=void 0,this.gpuBufferData=void 0,this.mlTensorData=void 0,this.downloader=void 0,this.isDownloading=void 0,this.dataLocation="none"}ensureValid(){if("none"===this.dataLocation)throw Error("The tensor is disposed.")}reshape(e){if(this.ensureValid(),this.downloader||this.disposer)throw Error("Cannot reshape a tensor that owns GPU resource.");return T(this,e)}}let B=$,C=(e,t)=>{(void 0===u.trace?u.wasm.trace:u.trace)&&console.timeStamp(`${e}::ORT::${t}`)},x=(e,t)=>{let r=Error().stack?.split(/\r\n|\r|\n/g)||[],a=!1;for(let n=0;n<r.length;n++){if(a&&!r[n].includes("TRACE_FUNC")){let a=`FUNC_${e}::${r[n].trim().split(" ")[1]}`;t&&(a+=`::${t}`),C("CPU",a);return}r[n].includes("TRACE_FUNC")&&(a=!0)}},D=e=>{(void 0===u.trace?u.wasm.trace:u.trace)&&x("BEGIN",e)},G=e=>{(void 0===u.trace?u.wasm.trace:u.trace)&&x("END",e)};class I{constructor(e){this.handler=e}async run(e,t,r){D();let a={},n={};if("object"!=typeof e||null===e||e instanceof B||Array.isArray(e))throw TypeError("'feeds' must be an object that use input names as keys and OnnxValue as corresponding values.");let i=!0;if("object"==typeof t){if(null===t)throw TypeError("Unexpected argument[1]: cannot be null.");if(t instanceof B)throw TypeError("'fetches' cannot be a Tensor");if(Array.isArray(t)){if(0===t.length)throw TypeError("'fetches' cannot be an empty array.");for(let e of(i=!1,t)){if("string"!=typeof e)throw TypeError("'fetches' must be a string array or an object.");if(-1===this.outputNames.indexOf(e))throw RangeError(`'fetches' contains invalid output name: ${e}.`);a[e]=null}if("object"==typeof r&&null!==r)n=r;else if(void 0!==r)throw TypeError("'options' must be an object.")}else{let e=!1,o=Object.getOwnPropertyNames(t);for(let r of this.outputNames)if(-1!==o.indexOf(r)){let n=t[r];(null===n||n instanceof B)&&(e=!0,i=!1,a[r]=n)}if(e){if("object"==typeof r&&null!==r)n=r;else if(void 0!==r)throw TypeError("'options' must be an object.")}else n=t}}else if(void 0!==t)throw TypeError("Unexpected argument[1]: must be 'fetches' or 'options'.");for(let t of this.inputNames)if(void 0===e[t])throw Error(`input '${t}' is missing in 'feeds'.`);if(i)for(let e of this.outputNames)a[e]=null;let o=await this.handler.run(e,a,n),s={};for(let e in o)if(Object.hasOwnProperty.call(o,e)){let t=o[e];t instanceof B?s[e]=t:s[e]=new B(t.type,t.data,t.dims)}return G(),s}async release(){return this.handler.dispose()}static async create(e,t,r,a){let n;D();let i={};if("string"==typeof e){if(n=e,"object"==typeof t&&null!==t)i=t;else if(void 0!==t)throw TypeError("'options' must be an object.")}else if(e instanceof Uint8Array){if(n=e,"object"==typeof t&&null!==t)i=t;else if(void 0!==t)throw TypeError("'options' must be an object.")}else if(e instanceof ArrayBuffer||"undefined"!=typeof SharedArrayBuffer&&e instanceof SharedArrayBuffer){let o=0,s=e.byteLength;if("object"==typeof t&&null!==t)i=t;else if("number"==typeof t){if(!Number.isSafeInteger(o=t))throw RangeError("'byteOffset' must be an integer.");if(o<0||o>=e.byteLength)throw RangeError(`'byteOffset' is out of range [0, ${e.byteLength}).`);if(s=e.byteLength-o,"number"==typeof r){if(!Number.isSafeInteger(s=r))throw RangeError("'byteLength' must be an integer.");if(s<=0||o+s>e.byteLength)throw RangeError(`'byteLength' is out of range (0, ${e.byteLength-o}].`);if("object"==typeof a&&null!==a)i=a;else if(void 0!==a)throw TypeError("'options' must be an object.")}else if(void 0!==r)throw TypeError("'byteLength' must be a number.")}else if(void 0!==t)throw TypeError("'options' must be an object.");n=new Uint8Array(e,o,s)}else throw TypeError("Unexpected argument[0]: must be 'path' or 'buffer'.");let[o,l]=await s(i),u=await o.createInferenceSessionHandler(n,l);return G(),new I(u)}startProfiling(){this.handler.startProfiling()}endProfiling(){this.handler.endProfiling()}get inputNames(){return this.handler.inputNames}get outputNames(){return this.handler.outputNames}}let R=I},9509:(e,t,r)=>{"use strict";var a,n;e.exports=(null==(a=r.g.process)?void 0:a.env)&&"object"==typeof(null==(n=r.g.process)?void 0:n.env)?r.g.process:r(666)}}]);